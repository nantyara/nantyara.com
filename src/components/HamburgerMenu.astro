---
interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

const menuItems = [
  { href: '/', label: '„É©„Ç§„Éñ‰∫àÂÆö', icon: 'üìÖ' },
  { href: '/releases', label: 'Èü≥Ê∫ê', icon: 'üéµ' },
  { href: '/members', label: '„É°„É≥„Éê„Éº', icon: 'üë•' },
  { href: '/history', label: 'Ê≤øÈù©', icon: 'üìñ' },
  { href: '/gallery', label: '„ÇÆ„É£„É©„É™„Éº', icon: 'üì∏' },
  { href: '/links', label: '„É™„É≥„ÇØ', icon: 'üîó' },
  { href: '/contact', label: '„ÅäÂïè„ÅÑÂêà„Çè„Åõ', icon: '‚úâÔ∏è' },
];
---

<nav class="hamburger-nav">
  <button class="hamburger-button" aria-label="„É°„Éã„É•„Éº" aria-expanded="false">
    <span class="hamburger-icon">
      <span class="line"></span>
      <span class="line"></span>
      <span class="line"></span>
    </span>
  </button>

  <div class="menu-overlay"></div>

  <div class="menu-drawer">
    <div class="menu-header">
      <h2 class="menu-title">MENU</h2>
    </div>

    <ul class="menu-list">
      {menuItems.map(item => (
        <li class="menu-item">
          <a
            href={item.href}
            class={`menu-link ${currentPath === item.href ? 'active' : ''}`}
            aria-current={currentPath === item.href ? 'page' : undefined}
          >
            <span class="menu-icon">{item.icon}</span>
            <span class="menu-label">{item.label}</span>
          </a>
        </li>
      ))}
    </ul>

    <div class="menu-position-toggle">
      <span class="toggle-label">„Éú„Çø„É≥‰ΩçÁΩÆ:</span>
      <button class="toggle-btn" data-position="left">Â∑¶</button>
      <button class="toggle-btn" data-position="right">Âè≥</button>
    </div>
  </div>
</nav>

<script>
  function initHamburgerMenu() {
    const hamburgerButton = document.querySelector('.hamburger-button');
    const menuOverlay = document.querySelector('.menu-overlay');
    const menuDrawer = document.querySelector('.menu-drawer');

    const openMenu = () => {
      menuDrawer?.classList.add('open');
      menuOverlay?.classList.add('open');
      hamburgerButton?.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    };

    const closeMenu = () => {
      menuDrawer?.classList.remove('open');
      menuOverlay?.classList.remove('open');
      hamburgerButton?.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    };

    const toggleMenu = () => {
      if (menuDrawer?.classList.contains('open')) {
        closeMenu();
      } else {
        openMenu();
      }
    };

    hamburgerButton?.addEventListener('click', toggleMenu);
    menuOverlay?.addEventListener('click', closeMenu);

    // „É°„Éã„É•„Éº„É™„É≥„ÇØ„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÇÇÈñâ„Åò„Çã
    document.querySelectorAll('.menu-link').forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    // „Éú„Çø„É≥‰ΩçÁΩÆ„Éà„Ç∞„É´Ôºà„Ç§„Éô„É≥„Éà„Éá„É™„Ç≤„Éº„Ç∑„Éß„É≥Ôºâ
    const updateToggleUI = () => {
      const pos = document.documentElement.getAttribute('data-menu-position') || 'right';
      document.querySelectorAll('.toggle-btn').forEach(btn => {
        if (btn instanceof HTMLElement) {
          btn.classList.toggle('active', btn.dataset.position === pos);
        }
      });
    };
    updateToggleUI();

    document.addEventListener('click', (e) => {
      const target = (e.target as Element)?.closest('.toggle-btn');
      if (!target || !(target instanceof HTMLElement)) return;
      const pos = target.dataset.position || 'right';
      if (pos === 'left') {
        document.documentElement.setAttribute('data-menu-position', 'left');
      } else {
        document.documentElement.removeAttribute('data-menu-position');
      }
      try { localStorage.setItem('menu-button-position', pos); } catch(e) {}
      updateToggleUI();
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHamburgerMenu);
  } else {
    initHamburgerMenu();
  }
</script>

<style>
  .hamburger-nav {
    position: relative;
    z-index: 1000;
  }

  /* „Éè„É≥„Éê„Éº„Ç¨„Éº„Éú„Çø„É≥ */
  .hamburger-button {
    position: fixed;
    bottom: calc(20px + env(safe-area-inset-bottom, 0px));
    right: 20px;
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, var(--retro-purple) 0%, var(--retro-pink) 100%);
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    cursor: pointer;
    z-index: 1002;
    box-shadow:
      0 4px 0 rgba(0, 0, 0, 0.3),
      0 0 20px rgba(255, 110, 199, 0.5);
    transition: all 0.3s ease;
  }

  :global(html[data-menu-position="left"]) .hamburger-button {
    right: auto;
    left: 20px;
  }

  .hamburger-button:hover {
    transform: scale(1.1);
    box-shadow:
      0 6px 0 rgba(0, 0, 0, 0.3),
      0 0 30px rgba(255, 110, 199, 0.8);
  }

  .hamburger-icon {
    display: flex;
    flex-direction: column;
    gap: 5px;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  .line {
    width: 24px;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  /* „Ç™„Éº„Éê„Éº„É¨„Ç§ */
  .menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 1000;
  }

  .menu-overlay.open {
    opacity: 1;
    visibility: visible;
  }

  /* „É°„Éã„É•„Éº„Éâ„É≠„ÉØ„Éº */
  .menu-drawer {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    max-width: 400px;
    height: 100%;
    background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
    border-left: 3px solid var(--retro-pink);
    box-shadow: -4px 0 30px rgba(0, 0, 0, 0.8);
    transition: right 0.3s ease;
    z-index: 1001;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .menu-drawer.open {
    right: 0;
  }

  /* „É°„Éã„É•„Éº„Éò„ÉÉ„ÉÄ„Éº */
  .menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: calc(30px + env(safe-area-inset-top, 0px)) 20px 30px;
    border-bottom: 2px solid var(--retro-pink);
    background: linear-gradient(90deg, var(--retro-purple) 0%, var(--retro-pink) 100%);
  }

  .menu-title {
    font-family: 'Rampart One', sans-serif;
    font-size: 2.2rem;
    font-weight: 400;
    color: white;
    text-shadow:
      2px 2px 0 rgba(0, 0, 0, 0.5),
      0 0 15px rgba(255, 255, 255, 0.5);
    margin: 0;
    letter-spacing: 4px;
  }

  /* „É°„Éã„É•„Éº„É™„Çπ„Éà */
  .menu-list {
    list-style: none;
    padding: 20px 0;
    margin: 0;
    flex: 1;
  }

  .menu-item {
    margin: 0;
  }

  .menu-link {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px 30px;
    text-decoration: none;
    color: var(--text-light);
    font-family: 'RocknRoll One', sans-serif;
    font-size: 1.2rem;
    font-weight: 400;
    transition: all 0.3s ease;
    border-left: 4px solid transparent;
  }

  .menu-link:hover {
    background: rgba(255, 110, 199, 0.1);
    border-left-color: var(--retro-pink);
  }

  .menu-link.active {
    background: linear-gradient(90deg, rgba(0, 255, 255, 0.2) 0%, transparent 100%);
    border-left-color: var(--retro-cyan);
    color: var(--retro-cyan);
  }

  .menu-icon {
    font-size: 1.8rem;
    width: 40px;
    text-align: center;
  }

  .menu-label {
    flex: 1;
  }

  /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
  @media (max-width: 480px) {
    .hamburger-button {
      width: 52px;
      height: 52px;
      bottom: calc(15px + env(safe-area-inset-bottom, 0px));
      right: 15px;
    }

    :global(html[data-menu-position="left"]) .hamburger-button {
      right: auto;
      left: 15px;
    }

    .line {
      width: 20px;
    }

    .menu-drawer {
      max-width: 100%;
    }

    .menu-header {
      padding: calc(20px + env(safe-area-inset-top, 0px)) 15px 20px;
    }

    .menu-title {
      font-size: 1.8rem;
      letter-spacing: 3px;
    }

    .menu-link {
      padding: 18px 20px;
      font-size: 1.1rem;
    }

    .menu-icon {
      font-size: 1.5rem;
      width: 35px;
    }
  }

  /* „Éú„Çø„É≥‰ΩçÁΩÆ„Éà„Ç∞„É´ */
  .menu-position-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 20px;
    border-top: 1px solid rgba(255, 110, 199, 0.3);
    margin-top: auto;
  }

  .toggle-label {
    font-size: 0.9rem;
    color: var(--pastel-lavender);
  }

  .toggle-btn {
    padding: 6px 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    background: transparent;
    color: var(--text-light);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .toggle-btn:hover {
    border-color: var(--retro-pink);
  }

  .toggle-btn.active {
    background: linear-gradient(135deg, var(--retro-purple) 0%, var(--retro-pink) 100%);
    border-color: var(--retro-pink);
    color: white;
  }

  /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁÑ°ÂäπÂåñÔºà„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Ôºâ */
  @media (prefers-reduced-motion: reduce) {
    .hamburger-button,
    .menu-overlay,
    .menu-drawer,
    .menu-link {
      transition: none !important;
    }

    .hamburger-button:hover {
      transform: none;
    }
  }
</style>
